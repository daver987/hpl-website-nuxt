generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider     = "mysql"
  url          = env("DATABASE_URL")
  relationMode = "prisma"
}

generator zod {
  provider           = "zod-prisma-types"
  createPartialTypes = true
}

model Account {
  id                     String   @id @unique @default(uuid())
  created_at             DateTime @default(now())
  updated_at             DateTime @updatedAt
  company_name           String
  company_address        String
  company_phone          String?
  company_email          String
  company_account_number Int
  users                  User[]
}

model User {
  id                   String      @id @default(uuid())
  created_at           DateTime    @default(now())
  updated_at           DateTime    @updatedAt
  first_name           String
  last_name            String
  email_address        String      @unique
  phone_number         String
  phone_number_country String?
  stripe_customer_id   String?
  is_customer          Boolean     @default(false)
  account_id           String?
  notes                String?
  meta_data            Json?
  quotes               Quote[]
  Account              Account?    @relation(fields: [account_id], references: [id])
  conversion           Conversion?

  @@index([account_id])
}

model Conversion {
  id              String   @id @default(uuid())
  created_at      DateTime @default(now())
  updated_at      DateTime @updatedAt
  utm_term        String?
  utm_medium      String?
  utm_source      String?
  utm_campaign    String?
  gclid           String?
  source          String?
  conversion_name String?
  user_id         String   @unique
  user            User     @relation(fields: [user_id], references: [id])
}

model Quote {
  quote_number        Int        @id @default(autoincrement())
  created_at          DateTime   @default(now())
  updated_at          DateTime   @updatedAt
  selected_hours      Int?       @default(2)
  selected_passengers Int        @default(1)
  is_round_trip       Boolean    @default(false)
  is_booked           Boolean    @default(false)
  user_id             String
  quote_total         Float
  quote_subtotal      Float?
  quote_tax_total     Float?
  short_link          String?
  service_id          Int
  vehicle_id          Int
  sales_tax_id        Int
  service             Service    @relation(fields: [service_id], references: [value])
  vehicle             Vehicle    @relation(fields: [vehicle_id], references: [value])
  user                User       @relation(fields: [user_id], references: [id])
  sales_tax           SalesTax   @relation(fields: [sales_tax_id], references: [id])
  line_items          LineItem[]
  trips               Trip[]
  payment             Payment?

  @@index([user_id])
  @@index([sales_tax_id])
  @@index([vehicle_id])
  @@index([service_id])
}

model Trip {
  id                    String     @id @unique @default(uuid())
  created_at            DateTime   @default(now())
  updated_at            DateTime   @updatedAt
  pickup_date           Float?
  pickup_time           Float?
  formatted_pickup_date String
  formatted_pickup_time String
  distance_text         String?
  duration_text         String?
  duration_value        Int?
  distance_value        Int?
  calculated_distance   Float?
  quote_number          Int
  service_label         String?
  vehicle_label         String?
  line_items_list       Json?
  line_items_subtotal   Float?
  line_items_tax        Float?
  line_items_total      Float?
  affiliate_payout      Float?
  is_farmed_out         Boolean?   @default(false)
  is_return             Boolean    @default(false)
  notes                 String?
  quote                 Quote      @relation(fields: [quote_number], references: [quote_number])
  Payment               Payment?
  locations             Location[]
  flight                Flight?

  @@index([quote_number])
}

model Flight {
  id                    String    @id @default(uuid())
  created_at            DateTime  @default(now())
  updated_at            DateTime  @updatedAt
  airline_code          String
  airline_name          String?
  flight_number         String
  is_active             Boolean   @default(false)
  is_landed             Boolean   @default(false)
  is_arrived            Boolean   @default(false)
  departure_time        DateTime?
  arrival_time          DateTime?
  departure_time_actual DateTime?
  arrival_time_actual   DateTime?
  trip_id               String?   @unique
  trip                  Trip?     @relation(fields: [trip_id], references: [id])
}

model Location {
  id                String   @id @default(uuid())
  created_at        DateTime @default(now())
  updated_at        DateTime @updatedAt
  lat               Float
  lng               Float
  name              String
  formatted_address String
  full_name         String?
  place_id          String
  types             Json
  route_order       Int      @default(value: 0)
  is_origin         Boolean  @default(false)
  is_destination    Boolean  @default(false)
  is_waypoint       Boolean  @default(false)
  trip_id           String
  trip              Trip     @relation(fields: [trip_id], references: [id])

  @@index([trip_id])
}

model Payment {
  id               String   @id @default(uuid())
  created_at       DateTime @default(now())
  updated_at       DateTime @updatedAt
  is_preauthorized Boolean  @default(false)
  is_paid          Boolean  @default(false)
  setup_intent     Json?
  payment_intent   Json?
  payment_type     String?
  notes            String?
  trip_id          String   @unique
  quote_number     Int      @unique
  trip             Trip     @relation(fields: [trip_id], references: [id])
  quote            Quote    @relation(fields: [quote_number], references: [quote_number])
}

model Service {
  value            Int      @id @unique @default(autoincrement())
  created_at       DateTime @default(now())
  updated_at       DateTime @updatedAt
  label            String
  is_active        Boolean  @default(false)
  is_hourly        Boolean  @default(false)
  limo_anywhere_id Int?
  quotes           Quote[]
}

model LineItem {
  id            String   @id @unique @default(uuid())
  created_at    DateTime @default(now())
  updated_at    DateTime @updatedAt
  label         String
  description   String?
  is_percentage Boolean  @default(true)
  is_taxable    Boolean  @default(true)
  is_active     Boolean  @default(true)
  amount        Float
  applies_to    String?
  quotes        Quote[]
}

model SalesTax {
  id         Int      @id @unique @default(autoincrement())
  created_at DateTime @default(now())
  updated_at DateTime @updatedAt
  tax_name   String
  amount     Float
  region     String
  is_active  Boolean  @default(true)
  quotes     Quote[]
}

model Vehicle {
  value            Int      @id @unique @default(autoincrement())
  created_at       DateTime @default(now())
  updated_at       DateTime @updatedAt
  max_passengers   Int      @default(0)
  max_luggage      Int      @default(0)
  per_km           Float    @default(0)
  per_hour         Float    @default(0)
  min_hours        Int      @default(0)
  min_distance     Int      @default(0)
  min_rate         Float    @default(0)
  is_active        Boolean  @default(true)
  label            String
  limo_anywhere_id Int?
  vehicle_image    String?
  quotes           Quote[]
}

model LineItemToQuote {
  A String
  B Int

  @@unique([A, B], map: "_LineItemToQuote_AB_unique")
  @@index([B], map: "_LineItemToQuote_B_index")
  @@map("_LineItemToQuote")
}
